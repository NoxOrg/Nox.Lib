#
# Store.entity.nox.yaml
#
## TODO: yaml-language-server: $schema=https://noxorg.dev/schemas/Entity.json
#

name: Store
description: Cache Store
pluralName: Stores
table: Store
schema: dbo

messaging:
  - messagingProvider: Mediator
    
isAggregateRoot: true

raiseCrudEvents: 
  create: yes
  update: yes
  delete: no

relations:
  - name: Reservations
    entity: Reservation
    isCollection: true
    isRequired: true # to model 1-1* or 1-0* relations

  - name: CacheBalances
    entity: CurrencyCacheBalance
    isCollection: true
    isRequired: true

queries:
    - name: ActiveReservations
      parameters:  # simple parameters or DTO in case of complex parameters set with validation / permissions etc
       - name: storeId
         type: int # can be DTO here
      response:
        responseDto: ReservationInfoDto
        isCollection: true

commands:
    - name: Reserve
      parameters: 
       - name: reserveCommandDto
         type: ReserveDto # can be DTO or simple type here
      events: [BalanceChanged]
      
    - name: Exchange
      parameters: 
       - name: exchangeCommandDto
         type: ExchangeDto # can be DTO or simple type here
      events: [BalanceChanged]

events:
    - name: BalanceChanged
      dto: BalanceChanged # TODO discuss naming
      provider: Mediator

attributes:

  - name: Id
    description: The store's unique identifier 
    isPrimaryKey: true
    type: int
    canFilter: true
    canSort: true

  - name: Name
    description: The store's common name 
    isRequired: true
    type: string
    maxWidth: 64
    canFilter: true
    canSort: true