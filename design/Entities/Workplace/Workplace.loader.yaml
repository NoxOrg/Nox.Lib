#
# Workplace data loader definition
#

Name: WorkplaceLoader

Description: Loads workplace data 

Schedule:
  Start: Daily at 2am UTC
  Retry:
    Limit: 10
    DelaySeconds: 60
    DoubleDelayLimit: 5

LoadStrategy: 
  Type: MergeNew
  Columns: [CreateDate,EditDate]


Target:
  Entity: Workplace

Sources:
  - ConnectionVariable: ConnectionString:MasterDataSource
    DatabaseProvider: SqlServer
    MinimumExpectedRecords: 3000
    Query: >-
      SELECT  [CentreNumber] AS [Id]
              ,[CentreName] AS [Name]
              ,[Latitude]
              ,[Longitude]
              ,[Country].[CountryISONumber] AS [CountryId]
              ,[BrandID] AS [BrandId]
              ,[Centre].[CreateDate] AS [CreateDate]
              ,[Centre].[EditDate] AS [EditDate]
      FROM 		  [TitanProduction].[dbo].[Centre] WITH (NOLOCK)
      LEFT JOIN	[Country] ON [Country].[CountryID]=[Centre].[CountryID]
      WHERE 		[Centre].[IsCurrentVersion]=1